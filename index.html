<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.0.4/math.min.js"></script>
</head>
<body>
    <div class="row" id="main">
        <div class="col-2 offset-1">
            <label for="supply">Increase/Decrease Supply:</label>
            <input type="range"
                   id="supply"
                   name="supply"
                   value="0"
                   min="-20"
                   max="20"
                   step="1">
            <label for="demand">Increase/Decrease Demand:</label>
            <input type="range"
                   id="demand"
                   name="demand"
                   value="0"
                   min="-20"
                   max="20"
                   step="1">
            <label for="s-elasticity">Supply Elasticity:</label>
            <input type="range"
                   id="s-elasticity"
                   name="s-elasticity"
                   value="1"
                   min="0.1"
                   max="10"
                   step="0.1">
            <label for="d-elasticity">Demand Elasticity:</label>
            <input type="range"
                   id="d-elasticity"
                   name="d-elasticity"
                   value="1"
                   min="0.1"
                   max="10"
                   step="0.1">
        </div>
        <div class="col-9">
            <div style="width: 600px; height: 600px;">
                <canvas id="myChart" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
</body>
<footer>
    <script>
        const maxDims = 20;

        let getSupplyGradient = () => {
            return -parseFloat(document.getElementById('s-elasticity').value);
        };

        let getSupplyIntercept = () => {
            return maxDims - parseFloat(document.getElementById('supply').value);
        };

        let getDemandGradient = () => {
            return parseFloat(document.getElementById('d-elasticity').value);
        };

        let getDemandIntercept = () => {
            return parseFloat(document.getElementById('demand').value);
        };

        let createSupply = () => {
            let intercept = getSupplyIntercept();
            let gradient = getSupplyGradient();
            let coordinates = [];
            for (let i = 0; i <= maxDims; i++) {
                let x = i;
                let y = gradient * x + intercept;
                coordinates.push({x,y});
            }
            return coordinates
        };

        let createDemand = () => {
            let intercept = getDemandIntercept();
            let gradient = getDemandGradient();
            let coordinates = [];
            for (let i = 0; i <= maxDims; i++) {
                let x = i;
                let y = gradient * x + intercept;
                coordinates.push({x,y});
            }
            return coordinates
        };

        let getEquilibriumX = () => {
            let demand_gradient = getDemandGradient();
            let demand_intercept = getDemandIntercept();
            let supply_gradient = getSupplyGradient();
            let supply_intercept = getSupplyIntercept();
            return (demand_intercept - supply_intercept) / (supply_gradient - demand_gradient);
        };

        let getEquilibriumY = () => {
            let demand_gradient = getDemandGradient();
            let demand_intercept = getDemandIntercept();
            let equilibrium_x = getEquilibriumX();
            return equilibrium_x * demand_gradient + demand_intercept;
        };

        let createEquilibrium = () => {
            return [{x: getEquilibriumX(), y: getEquilibriumY()}];
        };

        let createEquilibriumVertical = () => {
            let coordinates = [];
            let equilibrium_x = getEquilibriumX();
            let equilibrium_y = getEquilibriumY();
            coordinates.push({x: equilibrium_x, y: 0});
            coordinates.push({x: equilibrium_x, y: equilibrium_y});
            return coordinates;
        };

        let createEquilibriumHorizontal = () => {
            let coordinates = [];
            let equilibrium_x = getEquilibriumX();
            let equilibrium_y = getEquilibriumY();
            coordinates.push({x: 0, y: equilibrium_y});
            coordinates.push({x: equilibrium_x, y: equilibrium_y});
            return coordinates;
        };

        let ctx = document.getElementById("myChart");
        let myChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                {
                    data: createEquilibrium(),
                    borderWidth: 4,
                    pointRadius: 15,
                    pointHoverRadius: 15,
                    backgroundColor: 'rgba(20, 90, 50, 0.5)',
                    fill: false
                },
                {
                    data: createSupply(),
                    borderWidth: 4,
                    borderColor: 'rgb(192, 57, 43)',
                    pointRadius: 0,
                    fill: false
                },
                {
                    data: createDemand(),
                    borderWidth: 4,
                    borderColor: 'rgb(0, 0, 161)',
                    pointRadius: 0,
                    fill: false
                },
                {
                    data: createEquilibriumVertical(),
                    borderWidth: 4,
                    borderColor: 'rgba(20, 90, 50, 0.5)',
                    pointRadius: 0,
                    fill: false,
                    borderDash: [5, 5]
                },
                {
                    data: createEquilibriumHorizontal(),
                    borderWidth: 4,
                    borderColor: 'rgba(20, 90, 50, 0.5)',
                    pointRadius: 0,
                    fill: false,
                    borderDash: [5, 5]
                }]
            },
            options: {

                legend: {
                    display: false
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            min: 0,
                            max: maxDims
                        }
                    }],
                    xAxes: [{
                        id: 'x-axis',
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                            beginAtZero: true,
                            min: 0,
                            max: maxDims
                        }
                    }]
                },
                tooltips: {
                    enabled: false
                }
            }
        });

        let updateChartData = () => {
            let dataSets = myChart.data.datasets;
            dataSets[0].data = createEquilibrium();
            dataSets[1].data = createSupply();
            dataSets[2].data = createDemand();
            dataSets[3].data = createEquilibriumVertical();
            dataSets[4].data = createEquilibriumHorizontal();
            myChart.update();
        };

        document.getElementById('s-elasticity').onchange = updateChartData;
        document.getElementById('demand').onchange = updateChartData;
        document.getElementById('d-elasticity').onchange = updateChartData;
        document.getElementById('supply').onchange = updateChartData;
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

</footer>
</html>